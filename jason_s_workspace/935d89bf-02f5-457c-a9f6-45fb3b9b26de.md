---
id: 935d89bf-02f5-457c-a9f6-45fb3b9b26de
title: "Database"
icon: "ğŸ˜˜"
createdAt: 2026-02-17T15:58:26.408623
updatedAt: 2026-02-18T03:35:14.937585
---

# Database

## Sharding (Database Sharding)
**Sharding** lÃ  ká»¹ thuáº­t **horizontal partitioning** â€“ chia dá»¯ liá»‡u cá»§a má»™t logical dataset thÃ nh nhiá»u pháº§n nhá» (shards) vÃ  phÃ¢n phá»‘i chÃºng trÃªn nhiá»u node/instance váº­t lÃ½ khÃ¡c nhau.
Má»¥c tiÃªu chÃ­nh:
- Scale **write throughput**

- Scale **storage capacity**

- Giáº£m contention trÃªn single node

- TÄƒng tÃ­nh sáºµn sÃ ng (khi káº¿t há»£p replication)

---
## 1. Khi nÃ o cáº§n sharding?
Sharding thÆ°á»ng Ä‘Æ°á»£c Ã¡p dá»¥ng khi:
- Single database instance khÃ´ng cÃ²n scale Ä‘Æ°á»£c (CPU, RAM, IOPS bottleneck).

- Vertical scaling (scale up) quÃ¡ Ä‘áº¯t hoáº·c Ä‘Ã£ Ä‘áº¡t giá»›i háº¡n.

- Write-heavy workload.

- Dataset quÃ¡ lá»›n (TBâ€“PB scale).

VÃ­ dá»¥ cÃ¡c há»‡ thá»‘ng sá»­ dá»¥ng sharding:
- Facebook

- Instagram

- Uber

---
## 2. CÃ¡c loáº¡i sharding strategy
### 2.1 Range-based Sharding
Chia dá»¯ liá»‡u theo khoáº£ng giÃ¡ trá»‹.
VÃ­ dá»¥:
UserID 1â€“1M     â†’ Shard 1
UserID 1Mâ€“2M    â†’ Shard 2
**Æ¯u Ä‘iá»ƒm:**
- Dá»… implement

- Query theo range nhanh

**NhÆ°á»£c Ä‘iá»ƒm:**
- Hotspot náº¿u key tÄƒng dáº§n (vÃ­ dá»¥ auto-increment ID)

- Data skew

---
### 2.2 Hash-based Sharding
DÃ¹ng hash function:
shard = hash(user_id) % N
**Æ¯u Ä‘iá»ƒm:**
- PhÃ¢n phá»‘i Ä‘á»u

- TrÃ¡nh hotspot

**NhÆ°á»£c Ä‘iá»ƒm:**
- KhÃ³ scale tá»« N â†’ N+1 (cáº§n rehash toÃ n bá»™)

---
### 2.3 Consistent Hashing
Giáº£i quyáº¿t váº¥n Ä‘á» rebalancing khi thay Ä‘á»•i sá»‘ node.
ÄÆ°á»£c dÃ¹ng trong:
- [Apache Cassandra](https://www.namecheap.com/logo-maker/app/editor)

- Amazon DynamoDB

**Æ¯u Ä‘iá»ƒm:**
- ThÃªm/bá»›t node Ã­t di chuyá»ƒn data

- PhÃ¹ há»£p distributed systems

---
### 2.4 Directory-based Sharding
CÃ³ má»™t mapping service:
user_id â†’ shard_location
Æ¯u Ä‘iá»ƒm:
- Flexible

- Dá»… migrate user giá»¯a shard

NhÆ°á»£c Ä‘iá»ƒm:
- Cáº§n maintain lookup layer

- Single point of failure náº¿u khÃ´ng replicate

---
## 3. CÃ¡c váº¥n Ä‘á» khi dÃ¹ng sharding
### 3.1 Cross-shard query
JOIN giá»¯a nhiá»u shard ráº¥t tá»‘n kÃ©m.
Giáº£i phÃ¡p:
- Denormalization

- Event-driven sync

- Query fan-out (parallel query rá»“i aggregate)

---
### 3.2 Transaction
Distributed transaction ráº¥t phá»©c táº¡p.
ThÆ°á»ng dÃ¹ng:
- Saga pattern

- Eventual consistency

- Idempotent operation

---
### 3.3 Rebalancing
Khi:
- Má»™t shard quÃ¡ lá»›n

- Má»™t shard bá»‹ hotspot

Cáº§n:
- Resharding

- Data migration

- Traffic draining

---
### 3.4 Hotspot problem
VÃ­ dá»¥:
- Shard theo country â†’ VN user tÄƒng máº¡nh â†’ shard VN quÃ¡ táº£i.

Giáº£i phÃ¡p:
- Composite shard key

- Hash prefix

- Virtual shard

---
## 4. Sharding vs Replication
ShardingReplicationMá»¥c tiÃªuScale out storage & writeTÄƒng availability & readDataMá»—i node giá»¯ 1 pháº§nMá»—i node giá»¯ full dataQueryPhá»©c táº¡pÄÆ¡n giáº£n
Thá»±c táº¿ production thÆ°á»ng káº¿t há»£p cáº£ hai.

---
## 5. Sharding trong thá»±c táº¿ há»‡ thá»‘ng lá»›n
### Facebook
- Shard theo user_id

- Má»—i shard láº¡i cÃ³ replication

### MongoDB
- Built-in sharding

- Mongos router

- Config server

### MySQL
- KhÃ´ng native sharding

- ThÆ°á»ng implement á»Ÿ application layer

---
## 6. VÃ­ dá»¥ thá»±c táº¿ (Application-level sharding)
Giáº£ sá»­ báº¡n build há»‡ thá»‘ng chat:
def get_shard(user_id):
    return hash(user_id) % 4
- user 123 â†’ shard 3

- user 124 â†’ shard 1

Connection string mapping:
shard_0 â†’ db0.internal
shard_1 â†’ db1.internal
...

---
## 7. Nhá»¯ng kiáº¿n thá»©c cáº§n hiá»ƒu sÃ¢u náº¿u muá»‘n master sharding
Náº¿u báº¡n muá»‘n Ä‘i theo hÆ°á»›ng DevOps / Distributed Systems nhÆ° hiá»‡n táº¡i báº¡n Ä‘ang Ä‘á»‹nh hÆ°á»›ng:
- CAP theorem

- Consistency model (strong vs eventual)

- Distributed consensus (Raft, Paxos)

- Rebalancing algorithm

- Data locality

- Hot key mitigation

---
## 8. Káº¿t luáº­n
Sharding khÃ´ng chá»‰ lÃ  chia báº£ng.
NÃ³ lÃ  bÃ i toÃ¡n:
- Data distribution

- Load balancing

- Fault tolerance

- Distributed systems trade-offs

Khi há»‡ thá»‘ng Ä‘áº¡t quy mÃ´ lá»›n, sharding gáº§n nhÆ° lÃ  **báº¯t buá»™c**, nhÆ°ng cÃ¡i giÃ¡ pháº£i tráº£ lÃ  complexity tÄƒng theo cáº¥p sá»‘ nhÃ¢n.

---
Náº¿u báº¡n muá»‘n, tÃ´i cÃ³ thá»ƒ:
- Giáº£i thÃ­ch sharding theo gÃ³c nhÃ¬n system design interview

- Hoáº·c phÃ¢n tÃ­ch cÃ¡ch shard cho má»™t app cá»¥ thá»ƒ (vÃ­ dá»¥ app Notion clone cá»§a báº¡n)
